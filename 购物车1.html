
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>购物车</title>
    <meta charset="utf-8" />
    <link href="css/m_lib.css" rel="stylesheet" />
    <link href="css/weui.min.css" rel="stylesheet" />
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.tmpl.min.js"></script>
    <script src="js/common.js"></script>
    <script src="js/cake.js"></script>
    <script src="js/hammer.min.js"></script>
    <style type="text/css">
.head{background:#6A5F58;padding:20px;display:none;}
.contentTab{width:100%;}
.title{text-align:center;font-size:32px;color:#fff;}
.btnImg{cursor:pointer;width:50px;}
.prevLink{text-decoration:none;outline:none;}
.prevLink img{border:none;}
.cakeItem{background:#fff;border-bottom:1px solid #EDEDED;padding:20px;}
.cakeItemSel{background:#fdfce0 !important;}
.cakeImg{width:200px;height:160px;}
.cakeNum{border:1px solid #514242;font-size:30px;color:#514242;border-radius:5px;text-align:center;font-weight:bold;}
.btnNumTd{width:50px; text-align:center;cursor:pointer;padding-top:5px;}
.name{font-size:30px;color:#423030;margin-bottom:10px;}
.norms{font-size:26px;color:#645656;margin-bottom:10px;}
.money{color:#434343;font-size:26px;}        
.selFirst{background:#6A5F58;color:#fff;font-size:28px;text-align:center;position:fixed;padding:20px;text-align:center;top:300px;width:200px;border-radius:5px;display:none;}
.resultDiv{background:#fff;border-top:1px solid #C8C8C8;position:fixed;bottom:0px;width:100%;z-index:1;}
.calculat{background:#343534;padding:30px;width:100px;text-align:center;cursor:pointer;}
.calculat a{text-decoration:none;outline:none;display:block;font-size:32px;color:#fff;}
.resTxt{font-size:30px;color:#686868;width:250px;padding-left:20px;}
.resMoney{font-size:30px;color:#FF5252;}
.check{width:40px;height:45px;background:url(imgs/checkBlock1.png) no-repeat 0px 5px;cursor:pointer;}
.checked{background:url(imgs/checking2.png) no-repeat 0px 5px !important;}
.checkTxt{color:#473636;font-size:30px;padding-right:50px;}
.delBtn{background:#ED1630 url(imgs/del1.png) no-repeat center center;height:200px;width:220px;cursor:pointer;position:absolute;display:none;right:0px;z-index:2;}
#noCard{font-size:32px;color:#C8C8C8;text-align:center;margin-top:180px;}
.noTxt{font-size:34px;color:#CBCBCB;margin-top:40px;}
.xs{display:block;}
.yc{display:none;}
    </style>
    
    <script id="cakesTemplate" type="text/x-jquery-tmpl">
        {{tmpl(data) '#tdEachTemplate'}}
    </script>
    <script id="tdEachTemplate" type="text/x-jquery-tmpl">
        <div class="cakeItem">
            <table class="contentTab">
                <tr>
                    <td class="clickTd" style="width:220px;">
                        <img class="cakeImg" src="${img}" />
                    </td>
                    <td class="clickTd">
                        <div class="name">${name}</div>
                        <div class="norms">规格：${type}</div>
                        <div class="money" money="${money}">￥${money}</div>
                    </td>
                    <td class="btnNumTd" onclick="cakeNum(this,0)"><img src="imgs/less.png" /></td>
                    <td style="width:60px;"><div class="cakeNum">${count}</div></td>
                    <td class="btnNumTd" onclick="cakeNum(this,1)"><img src="imgs/more.png" /></td>
                </tr>
            </table>
            <div class="delBtn"></div>
        </div>
    </script>
    
    <script type="text/javascript">
        var hammerList = [];
        $(function () {
             
            if ($(".cakeItem").length == 0) {
                $("#noCard").removeClass("yc").addClass("xs");
                $("#dlogo").removeClass("xs").addClass("yc");
                //$("#paybannber").removeClass("xs").addClass("yc");
            }else{
                $("#noCard").removeClass("xs").addClass("yc");
                $("#dlogo").removeClass("yc").addClass("xs");
                // $("#paybannber").removeClass("xs").addClass("yc");
            }
             
            var cakeList = [];
            ///cakeList.push({ ID: 1, img: "uplaod/cake2.png", name: "Type The Moon Cake坚果芝士幕斯", type: "2磅 约17*17(cm)", money: 288, count: 2 });
            //cakeList.push({ ID: 2, img: "uplaod/cake3.png", name: "Type The Moon Cake坚果芝士幕斯", type: "2磅 约17*17(cm)", money: 288, count: 2 });
    
            var resMoney = 0;
            for (var i = 0; i < cakeList.length; i++) {
                resMoney += cakeList[i].money;
            }
            //$(".resMoney").html("￥" + resMoney);
            //$(".resMoney").attr("money", resMoney);
    
            var data = { data: cakeList }
            //$('#cakesTemplate').tmpl(data).appendTo('#cakeList');
            /*
            //$(".clickTd").bind("click", function () {
            //    var pdiv = $(this).parent().parent().parent().parent();
            //    if (pdiv.hasClass("cakeItemSel")) pdiv.removeClass("cakeItemSel");
            //    else pdiv.addClass("cakeItemSel");
            })
            */
            $(".prevLink").bind("click", function () {
                window.history.back(-1);
            })
            

            $(".check").bind("click", function () {
                var tid = $(this).attr("tid");
             //   alert(tid);
                if ($(this).hasClass("checked")){
                    $(this).removeClass("checked");
                    if(tid == 'tableware') {
                        delbyproduct('4');
                        delproductext('tableware');
                        minmoney('5');
                    }else if(tid == 'champagne') {
                        delbyproduct('');
                        minmoney('');
                        delproductext('');
                        
                    }else if(tid == 'candle') {
                        delbyproduct('43');
                        minmoney('25');
                        delproductext('candle');
                    }else if(tid == 'hcard') {
                        delbyproduct('56');
                        minmoney('10');
                        delproductext('hcard');
                    }else if(tid == 'jifanxi') {
                        delbyproduct('');
                        minmoney('');
                        delproductext('');
                    }
                        
                    
                }else{
                    $(this).addClass("checked");
                    if(tid == 'tableware') {
                        addShoppingcar('4',1,'5','套');
                        addproductext('4','餐具','5','http://web.danggao.cn/upload/product/2016-01-25/f1499d55a39334fc549e8f052eea0966.jpg','tableware');
                        incmoney('5');
                        
                    }else if(tid == 'champagne') {
                        addShoppingcar('',1,'','');
                        addproductext('','','','','');
                        incmoney('');
                        
                    }else if(tid == 'candle') {
                        addShoppingcar('43',1,'25','套');
                        addproductext('43','生日蜡烛','25','http://web.danggao.cn/upload/product/2016-01-25/d1cc501fbb814ea17dd3bf77b0094880.jpg','candle');
                        incmoney('25');

                    }else if(tid == 'hcard') {
                        addShoppingcar('56',1,'10','张');
                        addproductext('56','生日贺卡','10','http://web.danggao.cn/upload/product/2016-02-24/f4bdabc4ef45c27e34ab7bf7b64ffa74.jpg','hcard');
                        incmoney('10');
                    }else if(tid == 'jifanxi') {
                        addShoppingcar('',1,'','');
                        addproductext('','','','','');
                        incmoney('');
                    }
                }
                
            })

            $(".cakeItem").each(function () {
                var tag = $(this);
                var hammertime = new Hammer(this);
                hammertime.on("swipeleft", function (e) {
                    tag.find(".delBtn").css({
                        height: tag.height() + 40,
                        top: tag.offset().top
                    }).show();
                });
                hammertime.on("swiperight", function (e) {
                    tag.find(".delBtn").hide();
                });
                hammerList.push(hammertime);
            })
           
            $(".delBtn").bind("click", function () {

                //var pdiv = $(this).parent().parent().parent().parent();
                //if (pdiv.hasClass("cakeItemSel")) pdiv.removeClass("cakeItemSel");
                //else pdiv.addClass("cakeItemSel");
                $(this).parent().addClass("cakeItemSel");
                
                delCake();
                $(this).parent().remove();
                $(".delBtn").each(function () {
                    if ($(".delBtn").css("display") != "none") {
                        $(this).css({
                            top: $(this).parent().offset().top
                        });
                    }
                })
                
                //alert($(".cakeItem").length);
                if ($(".cakeItem").length == 0) {
                    $("#noCard").removeClass("yc").addClass("xs");
                    $("#dlogo").removeClass("xs").addClass("yc");
                    $("#paybannber").removeClass("xs").addClass("yc");
                }else{
                    $("#noCard").removeClass("xs").addClass("yc");
                    $("#dlogo").removeClass("yc").addClass("xs");
                    $("#paybannber").removeClass("yc").addClass("xs");
                }
            })
        })
        

    
        function cakeNum(tag, num) {
            var price = $(tag).parent().find(".money").attr("money");
            var count = $(tag).parent().find(".cakeNum").html();
            var resMoney = $(".resMoney").attr("money");
            resMoney = parseInt(resMoney);
            count = parseInt(count);
            price = parseInt(price);
            resMoney -= price;
            price = price / count;
    
            if (num == 0) {
                count--;
                if (count <= 0) {

                    if($(tag).parent().parent().parent().parent().attr("productcate") == 'champagne') {
                        $("#champagne").removeClass("checked");
                    }

                    if($(tag).parent().parent().parent().parent().attr("productcate") == 'tableware') {
                        $("#tableware").removeClass("checked");
                    }

                    if($(tag).parent().parent().parent().parent().attr("productcate") == 'candle') {
                        $("#candle").removeClass("checked");
                    }
                    
                    if($(tag).parent().parent().parent().parent().attr("productcate") == 'hcard') {
                        $("#hcard").removeClass("checked");
                    }

                    if($(tag).parent().parent().parent().parent().attr("productcate") == 'jifanxi') {
                        $("#jifanxi").removeClass("checked");
                    }
                    
                    $(tag).parent().parent().parent().parent().remove();
                    $(".resMoney").attr("money", resMoney);
                    $(".resMoney").html("￥" + resMoney);
                    return;
                }
                price = price * count;
            }
            else {
                count++;
                price = price * count;
            }
            $(tag).parent().find(".money").attr("money", price);
            $(tag).parent().find(".money").html("￥" + price);
            $(tag).parent().find(".cakeNum").html(count)
    
            resMoney += price;
            $(".resMoney").attr("money", resMoney);
            $(".resMoney").html("￥" + resMoney);
        }
    
        function delCake() {
            if ($(".cakeItemSel").length == 0) {
                $(".selFirst").css({
                    left: ($(window).width() - $(".selFirst").width()) / 2
                })
                $(".selFirst").show();
                setTimeout(function () {
                    $(".selFirst").hide();
                }, 1000);
            }
            else {
    
                var ids = '';
                var sels = $(".cakeItemSel");
                for(var i=0;i<sels.length;i++) {
                    ids = ids+','+sels[i].id;
                }
                //alert(ids);
                delShoppingcar(ids);
                
                var price = $(".cakeItemSel").find(".money").attr("money");
                var resMoney = $(".resMoney").attr("money");
                resMoney = parseInt(resMoney);
                price = parseInt(price);
                resMoney -= price;
                $(".resMoney").attr("money", resMoney);
                $(".resMoney").html("￥" + resMoney);
                $(".cakeItemSel").remove();
                //alert(resMoney);
                
                if(sels.attr("productcate") == "tableware") {
                    $("#tableware").removeClass("checked");
                }
                if(sels.attr("productcate") == "champagne") {
                    $("#champagne").removeClass("checked");
                }
                if(sels.attr("productcate") == "candle") {
                    $("#candle").removeClass("checked");
                }
                if(sels.attr("productcate") == "hcard") {
                    $("#hcard").removeClass("checked");
                }
                if(sels.attr("productcate") == "jifanxi") {
                    $("#jifanxi").removeClass("checked");
                }
                
                var product_num = 0;
                $(".cakeItem").each(function () {
                    if($.trim( $(this).attr("productcate") ) == '') {
                        ++product_num;
                    }
                })
                if(product_num == 0) {
                    $(".cakeItem").each(function () {
                        $(this).remove();
                    })
                    $("#noCard").removeClass("yc").addClass("xs");
                    $("#dlogo").removeClass("xs").addClass("yc");
                    $("#paybannber").removeClass("xs").addClass("yc");
                    clearShoppingcar();
                }
                
            }
        }
    </script>
</head>
<body class="bgf5">

<div class="head">
    <table class="contentTab">
        <tr>
            <td class="btnImg">
                <div class="prevLink" href="cakes.html">
                    <img src="imgs/prev.png" />
                </div>
            </td>
            <td class="title">购物车</td>
            <td class="btnImg" onclick="delCake()"><img src="imgs/del.png" /></td>
        </tr>
    </table>
</div>
    
 
<div id="noCard" class="yc">
    <img src="imgs/gouwuche-empty.png" width="200" height="200"/>
    <div class="noTxt">购物车是空的</div>
</div>
 

<div id="cakeList">
    <div class="weui_panel weui_panel_access">
        <div class="weui_panel_bd">
            <div class="weui_media_box weui_media_appmsg">
                <div class="weui_media_hd">
                    <img class="weui_media_appmsg_thumb bdc" src="imgs/cake1.jpg" alt="">
                </div>
                <div class="weui_media_bd">
                    <h4 class="weui_media_title pb15">香草奶油草莓慕斯香草奶油香草奶油草莓慕斯</h4>
                    <p class="weui_media_desc">规格：6寸</p>
                </div>
                <div class="tr">
                    <h4 class="weui_media_title pb15">￥288.00</h4>
                    <p class="weui_media_desc">X1</p>
                </div>
            </div>
            <div class="weui_media_box weui_media_appmsg">
                <div class="weui_media_hd">
                    <img class="weui_media_appmsg_thumb bdc" src="imgs/cake1.jpg" alt="">
                </div>
                <div class="weui_media_bd">
                    <h4 class="weui_media_title pb15">标题二</h4>
                    <p class="weui_media_desc">规格：6寸</p>
                </div>
                <div class="tr">
                    <h4 class="weui_media_title pb15">￥288.00</h4>
                    <p class="weui_media_desc">X1</p>
                </div>
            </div>
            <div class="weui_media_box weui_media_appmsg">
                <div class="weui_media_bd">
                    <h4 class="weui_media_title pb10">配送费</h4>
                    <h4 class="weui_media_title">优惠</h4>
                </div>
                <div class="">
                    <h4 class="weui_media_title pb10">￥0.00</h4>
                    <h4 class="weui_media_title">￥0.00</h4>
                </div>
            </div>
            <div class="weui_media_box weui_media_appmsg">
                <div class="weui_media_bd">
                    <h4 class="weui_media_title"><span class="g9b">订单</span>￥576&nbsp;-&nbsp;<span class="g9b">优惠</span>￥0</h4>
                </div>
                <div class="tr">
                    <h4 class="weui_media_title">总计：<span class="ge4">￥0.00</span></h4>
                </div>
            </div>
        </div>
    </div>
    <div class="cakeItem" id="6029" pid="6029" productcate="" tid="prod_6029">
        <table class="contentTab">
            <tr>
                <td class="clickTd" style="width:220px;">
                    <img class="cakeImg" src="http://web.danggao.cn/upload/product/2016-04-12/7299fc7b8d05af879011125826d74bc3.jpg" onclick="window.location.href='/product/detail?id=49'"/>
                </td>
                <td class="clickTd">
                    <div class="name">焦糖酱香白酒慕斯</div>
                    <div class="norms">规格：288/8寸</div>
                    <div class="money" money="576">￥576</div>
                </td>
                <td class="btnNumTd" onclick="javascript:cakeNum(this,0);minusNum(6029,1);"><img src="imgs/less1.png" /></td>
                <td style="width:60px;"><div class="cakeNum">2</div></td>
                <td class="btnNumTd" onclick="javascript:cakeNum(this,1);addNum(6029,1);"><img src="imgs/more1.png" /></td>
            </tr>
        </table>
        <div class="delBtn"></div>
    </div>
    <div class="cakeItem" id="6034" pid="6034" productcate="" tid="prod_6034">
        <table class="contentTab">
            <tr>
                <td class="clickTd" style="width:220px;">
                    <img class="cakeImg" src="http://web.danggao.cn/upload/product/2016-04-12/0c72de2ff99dd9a1db7f2d5818931d94.jpg" onclick="window.location.href='/product/detail?id=63'"/>
                </td>
                <td class="clickTd">
                    <div class="name">巧克力覆盆子慕斯</div>
                    <div class="norms">规格：198/6寸</div>
                    <div class="money" money="396">￥396</div>
                </td>
                <td class="btnNumTd" onclick="javascript:cakeNum(this,0);minusNum(6034,1);"><img src="imgs/less1.png" /></td>
                <td style="width:60px;"><div class="cakeNum">2</div></td>
                <td class="btnNumTd" onclick="javascript:cakeNum(this,1);addNum(6034,1);"><img src="imgs/more1.png" /></td>
            </tr>
        </table>
        <div class="delBtn"></div>
    </div>
</div>



<div class="resultDiv xs" id="paybannber">
    <div style="margin:10px;">
        <table>
            <tr>
                
                                    <td><div class="check " id="tableware" tid="tableware" tval="4"></div></td>
                    <td class="checkTxt">餐具</td>
                
                                <td><div class="check " id="candle" tid="candle" tid="candle" tval="43"></div></td>
                <td class="checkTxt">生日蜡烛</td>
                                
                                <td><div class="check " id="hcard" tid="hcard" tid="hcard" tval="56"></div></td>
                <td class="checkTxt">生日贺卡</td>
                
                                
            </tr>
        </table>
    </div>

    
    <div style="border-top:1px solid #c8c8c8;">
        <table cellpadding="0" cellspacing="0" class="contentTab">
            <tr>
                <td class="resTxt">总价(不含运费)：</td>
                <td class="resMoney"></td>
                <td class="calculat"><a href="javascript:void()" onclick="toorder()">结算</a></td>
            </tr>
        </table>
    </div>
</div>

</body>
<script>
var ifclick = 0;
var resMoney = '972';
$(".resMoney").html("￥" + resMoney);
$(".resMoney").attr("money", resMoney);
$(".clickTd").bind("click", function () {
    var pdiv = $(this).parent().parent().parent().parent();
    if (pdiv.hasClass("cakeItemSel")) pdiv.removeClass("cakeItemSel");
    else pdiv.addClass("cakeItemSel");
})
$(".prevLink").bind("click", function () {
    window.history.back(-1);
})

function toorder() {
    if(ifclick==0) {
        ifclick = 1;
        window.location.href='/order/order?type=shoppingcar&addr_id=&pay_type=wxpay&shipping_type=';
    }
}

//添加餐具套餐香槟等 
function addproductext(id,name,price,img,product_cate) {
    var html = '<div class="cakeItem" id="'+id+'" pid="'+id+'" productcate="'+product_cate+'" tid="prod_'+id+'">';
    html +='<table class="contentTab">';
    html +='<tr>';
    html +='<td class="clickTd" style="width:220px;">';
    html +='<img class="cakeImg" src="'+img+'" onclick="window.location.href=\'/product/detail?id='+id+'\'">';
    html +='</td>';
    html +='<td class="clickTd">';
    html +='<div class="name">'+name+'</div>';
    html +='<div class="norms">规格：'+price+'/套</div>';
    html +='<div class="money" money="'+price+'">￥'+price+'</div>';
    html +='</td>';
    html +='<td class="btnNumTd" onclick="javascript:cakeNum(this,0);minusNum('+id+',1);"><img src="imgs/less1.png" /></td>';
    html +='<td style="width:60px;"><div class="cakeNum">1</div></td>';
    html +='<td class="btnNumTd" onclick="javascript:cakeNum(this,1);addNum('+id+',1);"><img src="imgs/more1.png" /></td>';
    html +='</tr>';
    html +='</table>';
    html +='<div class="delBtn"></div>';
        html +='</div>';
    
    $("#cakeList").append(html);

    $(".cakeItem").each(function () {
        var tag = $(this);
        var hammertime = new Hammer(this);
        hammertime.on("swipeleft", function (e) {
            tag.find(".delBtn").css({
                height: tag.height() + 40,
                top: tag.offset().top
            }).show();
        });
        hammertime.on("swiperight", function (e) {
            tag.find(".delBtn").hide();
        });
        hammerList.push(hammertime);
    })

    $(".delBtn").bind("click", function () {
        $(this).parent().addClass("cakeItemSel");
        delCake();
        $(this).parent().remove();
        
        if ($(".cakeItem").length == 0) {
            $("#noCard").removeClass("yc").addClass("xs");
            $("#dlogo").removeClass("xs").addClass("yc");
            $("#paybannber").removeClass("xs").addClass("yc");
        }else{
            $("#noCard").removeClass("xs").addClass("yc");
            $("#dlogo").removeClass("yc").addClass("xs");
            $("#paybannber").removeClass("yc").addClass("xs");
        }
    })
    
    if ($(".cakeItem").length == 0) {
        $("#noCard").removeClass("yc").addClass("xs");
        $("#dlogo").removeClass("xs").addClass("yc");
        $("#paybannber").removeClass("xs").addClass("yc");
    }else{
        $("#noCard").removeClass("xs").addClass("yc");
        $("#dlogo").removeClass("yc").addClass("xs");
        $("#paybannber").removeClass("yc").addClass("xs");
    }
}

function delproductext(product_cate) {
    $('#cakeList div').each(function(i) {
            if($(this).attr("productcate") == product_cate) {
                $(this).remove();
            }
        })
}

function incmoney(price) {
    var resMoney = $(".resMoney").attr("money");
    var price = parseInt(price);
    resMoney = parseInt(resMoney);
    resMoney += price
    $(".resMoney").attr("money", resMoney);
    $(".resMoney").html("￥" + resMoney);
}

function minmoney(price) {
    var resMoney = $(".resMoney").attr("money");
    var price = parseInt(price);
    resMoney = parseInt(resMoney);
    resMoney -= price;
    $(".resMoney").attr("money", resMoney);
    $(".resMoney").html("￥" + resMoney);
}
</script>
</html>